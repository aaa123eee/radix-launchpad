System.register([],function(M){"use strict";return{execute:function(){M("atom",U);let T=0;function U(t,r){const i=`atom${++T}`,d={toString(){return i}};return typeof t=="function"?d.read=t:(d.init=t,d.read=$,d.write=q),r&&(d.write=r),d}function $(t){return t(this)}function q(t,r,i){return r(this,typeof i=="function"?i(t(this)):i)}const O=(t,r)=>t.unstable_is?t.unstable_is(r):r===t,W=t=>"init"in t,B=t=>!!t.write,b=new WeakMap,E=t=>{var r;return z(t)&&!((r=b.get(t))!=null&&r[1])},x=(t,r)=>{const i=b.get(t);i&&(i[1]=!0,i[0].forEach(d=>d(r)))},J=t=>{if(b.has(t))return;const r=[new Set,!1];b.set(t,r);const i=()=>{r[1]=!0};t.then(i,i),t.onCancel=d=>{r[0].add(d)}},z=t=>typeof(t==null?void 0:t.then)=="function",F=t=>"v"in t||"e"in t,A=t=>{if("e"in t)throw t.e;return t.v},G=(t,r,i)=>{i.p.has(t)||(i.p.add(t),r.then(()=>{i.p.delete(t)},()=>{i.p.delete(t)}))},H=(t,r,i,d,y)=>{var S;i.d.set(d,y.n),E(i.v)&&G(r,i.v,y),(S=y.m)==null||S.t.add(r),t&&K(t,d,r)},g=()=>[new Map,new Map,new Set],I=(t,r,i)=>{t[0].has(r)||t[0].set(r,new Set),t[1].set(r,i)},K=(t,r,i)=>{const d=t[0].get(r);d&&d.add(i)},Q=(t,r)=>t[0].get(r),L=(t,r)=>{t[2].add(r)},p=t=>{for(;t[1].size||t[2].size;){t[0].clear();const r=new Set(t[1].values());t[1].clear();const i=new Set(t[2]);t[2].clear(),r.forEach(d=>{var y;return(y=d.m)==null?void 0:y.l.forEach(S=>S())}),i.forEach(d=>d())}},N=t=>{const r=(o,n,e)=>{const l="v"in n,a=n.v,u=E(n.v)?n.v:null;if(z(e)){J(e);for(const c of n.d.keys())G(o,e,t(c,n));n.v=e,delete n.e}else n.v=e,delete n.e;(!l||!Object.is(a,n.v))&&(++n.n,u&&x(u,e))},i=(o,n,e,l)=>{var a;if(!(l!=null&&l(n))&&F(e)&&(e.m||Array.from(e.d).every(([s,w])=>i(o,s,t(s,e),l).n===w)))return e;e.d.clear();let u=!0;const c=s=>{if(O(n,s)){const h=t(s,e);if(!F(h))if(W(s))r(s,h,s.init);else throw new Error("no atom init");return A(h)}const w=i(o,s,t(s,e),l);if(u)H(o,n,e,s,w);else{const h=g();H(h,n,e,s,w),k(h,n,e),p(h)}return A(w)};let m,f;const v={get signal(){return m||(m=new AbortController),m.signal},get setSelf(){return!f&&B(n)&&(f=(...s)=>{if(!u)return P(n,...s)}),f}};try{const s=n.read(c,v);if(r(n,e,s),z(s)){(a=s.onCancel)==null||a.call(s,()=>m==null?void 0:m.abort());const w=()=>{if(e.m){const h=g();k(h,n,e),p(h)}};s.then(w,w)}return e}catch(s){return delete e.v,e.e=s,++e.n,e}finally{u=!1}},d=o=>A(i(void 0,o,t(o))),y=(o,n,e)=>{var l,a;const u=new Map;for(const c of((l=e.m)==null?void 0:l.t)||[])u.set(c,t(c,e));for(const c of e.p)u.set(c,t(c,e));return(a=Q(o,n))==null||a.forEach(c=>{u.set(c,t(c,e))}),u},S=(o,n,e)=>{const l=[],a=new Set,u=(f,v)=>{if(!a.has(f)){a.add(f);for(const[s,w]of y(o,f,v))f!==s&&u(s,w);l.push([f,v,v.n])}};u(n,e);const c=new Set([n]),m=f=>a.has(f);for(let f=l.length-1;f>=0;--f){const[v,s,w]=l[f];let h=!1;for(const R of s.d.keys())if(R!==v&&c.has(R)){h=!0;break}h&&(i(o,v,s,m),k(o,v,s),w!==s.n&&(I(o,v,s),c.add(v))),a.delete(v)}},_=(o,n,e,...l)=>{const a=c=>A(i(o,c,t(c,e))),u=(c,...m)=>{const f=t(c,e);let v;if(O(n,c)){if(!W(c))throw new Error("atom not writable");const s="v"in f,w=f.v,h=m[0];r(c,f,h),k(o,c,f),(!s||!Object.is(w,f.v))&&(I(o,c,f),S(o,c,f))}else v=_(o,c,f,...m);return p(o),v};return n.write(a,u,...l)},P=(o,...n)=>{const e=g(),l=_(e,o,t(o),...n);return p(e),l},k=(o,n,e)=>{if(e.m&&!E(e.v)){for(const l of e.d.keys())e.m.d.has(l)||(j(o,l,t(l,e)).t.add(n),e.m.d.add(l));for(const l of e.m.d||[])if(!e.d.has(l)){e.m.d.delete(l);const a=D(o,l,t(l,e));a==null||a.t.delete(n)}}},j=(o,n,e)=>{if(!e.m){i(o,n,e);for(const l of e.d.keys())j(o,l,t(l,e)).t.add(n);if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},B(n)&&n.onMount){const l=e.m,{onMount:a}=n;L(o,()=>{const u=a((...c)=>_(o,n,e,...c));u&&(l.u=u)})}}return e.m},D=(o,n,e)=>{if(e.m&&!e.m.l.size&&!Array.from(e.m.t).some(l=>{var a;return(a=t(l,e).m)==null?void 0:a.d.has(n)})){const l=e.m.u;l&&L(o,l),delete e.m;for(const a of e.d.keys()){const u=D(o,a,t(a,e));u==null||u.t.delete(n)}return}return e.m};return{get:d,set:P,sub:(o,n)=>{const e=g(),l=t(o),a=j(e,o,l);p(e);const u=a.l;return u.add(n),()=>{u.delete(n);const c=g();D(c,o,l),p(c)}},unstable_derive:o=>N(...o(t))}},V=M("createStore",()=>{const t=new WeakMap;return N(r=>{let i=t.get(r);return i||(i={d:new Map,p:new Set,n:0},t.set(r,i)),i})});let C;const X=M("getDefaultStore",()=>(C||(C=V()),C))}}});
